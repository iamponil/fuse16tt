<div class="flex flex-col h-full bg-white relative">
    <!-- 1. Sticky Header -->
    <div
        class="flex items-center justify-between p-4 border-b bg-white sticky top-0 z-10 shadow-sm"
    >
        <div class="flex flex-col">
            <h1 class="text-xl font-bold m-0 leading-tight">
                {{ article?.title || "Loading..." }}
            </h1>
            <span class="text-xs text-gray-500 mt-1" *ngIf="article">
                By {{ article.authorName || "Unknown" }} â€¢
                {{ article.createdAt | date : "mediumDate" }}
            </span>
        </div>
        <button mat-icon-button (click)="close()">
            <mat-icon>close</mat-icon>
        </button>
    </div>

    <!-- 2. Scrollable Content Area -->
    <div #scrollContainer class="flex-1 overflow-y-auto custom-scroll p-0">
        <!-- Article Image Banner -->
        <div
            *ngIf="article?.image"
            class="w-full h-64 overflow-hidden relative bg-gray-100"
        >
            <img
                [src]="getImageUrl(article.image)"
                class="w-full h-full object-cover"
                alt="Article Banner"
            />
        </div>

        <!-- Main Content Container -->
        <div class="p-6 max-w-4xl mx-auto">
            <!-- Article Body -->
            <div
                class="prose max-w-none text-gray-800 text-lg leading-relaxed whitespace-pre-line mb-8"
            >
                {{ article?.content }}
            </div>

            <!-- Tags -->
            <div class="flex gap-2 mb-8" *ngIf="article?.tags?.length">
                <mat-chip-set>
                    <mat-chip *ngFor="let tag of article.tags">{{
                        tag
                    }}</mat-chip>
                </mat-chip-set>
            </div>

            <mat-divider></mat-divider>

            <!-- Comments Section Header -->
            <div class="mt-8 mb-6 flex items-center gap-2">
                <mat-icon class="text-gray-500">forum</mat-icon>
                <h3 class="text-xl font-bold m-0">
                    Comments ({{ comments.length }})
                </h3>
            </div>

            <!-- Comments List -->
            <div class="space-y-6 mb-10">
                <!-- Empty State -->
                <div
                    *ngIf="comments.length === 0"
                    class="text-center text-gray-500 py-8 italic"
                >
                    No comments yet. Be the first to share your thoughts!
                </div>

                <!-- Single Comment Loop -->
                <div *ngFor="let c of comments" class="flex gap-4">
                    <!-- Avatar Placeholder -->
                    <div
                        class="w-10 h-10 rounded-full bg-indigo-100 text-indigo-600 flex items-center justify-center font-bold flex-shrink-0"
                    >
                        {{
                            c.authorName
                                ? c.authorName.charAt(0).toUpperCase()
                                : "?"
                        }}
                    </div>

                    <div
                        class="flex-1 bg-gray-50 p-4 rounded-lg rounded-tl-none"
                    >
                        <div class="flex justify-between items-baseline mb-1">
                            <span class="font-bold text-sm text-gray-900">
                                {{ c.authorName || "Anonymous" }}
                            </span>
                            <span class="text-xs text-gray-400">
                                {{ c.createdAt | date : "short" }}
                            </span>
                        </div>
                        <p class="text-gray-700 text-sm m-0 leading-relaxed">
                            {{ c.content }}
                        </p>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- 3. Sticky Footer (Input Area) -->
    <div class="p-4 border-t bg-gray-50 sticky bottom-0 z-10">
        <div class="flex gap-3 max-w-4xl mx-auto items-start">
            <mat-form-field
                appearance="outline"
                class="w-full bg-white rounded-lg -mb-5"
                subscriptSizing="dynamic"
            >
                <mat-label>Add to the discussion...</mat-label>
                <textarea
                    matInput
                    [(ngModel)]="newComment"
                    cdkTextareaAutosize
                    #autosize="cdkTextareaAutosize"
                    cdkAutosizeMinRows="1"
                    cdkAutosizeMaxRows="5"
                    (keydown.enter)="$event.preventDefault(); sendComment()"
                ></textarea>
                <button
                    mat-icon-button
                    matSuffix
                    (click)="sendComment()"
                    [disabled]="!newComment.trim()"
                    color="primary"
                >
                    <mat-icon>send</mat-icon>
                </button>
            </mat-form-field>
        </div>
    </div>
</div>
